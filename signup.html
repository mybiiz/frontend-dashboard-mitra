<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1" name="viewport" />
	<meta name="description" content="Responsive Admin Template" />
	<meta name="author" content="SmartUniversity" />
	<title>Daftar | Mitra MyBiiz</title>
	<!-- icons -->
	<link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="assets/plugins/iconic/css/material-design-iconic-font.min.css">
	<!-- bootstrap -->
	<link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<!-- style -->
	<link rel="stylesheet" href="assets/css/pages/extra_pages.css">
	<!-- favicon -->
	<link rel="shortcut icon" href="assets/img/favicon.ico" />
</head>

<body>
	<div class="limiter">
		<div class="container-login100 page-background">
			<div class="wrap-login100">
				<form class="login100-form validate-form">
					<span class="login100-form-logo">
						<i class="zmdi zmdi-account"></i>
					</span>
					<span class="login100-form-title p-b-34 p-t-27">
						Daftar Mitra MyBiiz
					</span>
					<div class="row">
						<div class="col-lg-6 p-t-20">
							<div class="wrap-input100 validate-input" data-validate="Enter nomor handphone">
								<input id="phone-input" class="input100" type="text" name="phone" placeholder="Nomor HandPhone">
								<span class="focus-input100" data-placeholder="&#xf207;"></span>
							</div>
						</div>
						<div class="col-lg-6 p-t-20">
							<div class="wrap-input100 validate-input" data-validate="Enter email">
								<input  id="email-input" class="input100" type="email" name="email" placeholder="Email">
								<span class="focus-input100" data-placeholder="&#xf207;"></span>
							</div>
						</div>
						<div class="col-lg-6 p-t-20">
							<div class="wrap-input100 validate-input" data-validate="Enter password">
								<input id="password-input" class="input100" type="password" name="password" placeholder="Password">
								<span class="focus-input100" data-placeholder="&#xf191;"></span>
							</div>
						</div>
						<div class="col-lg-6 p-t-20">
							<div class="wrap-input100 validate-input" data-validate="Enter password again">
								<input id="password-confirm-input" class="input100" type="password" name="password-confirm" placeholder="Confirm password">
								<span class="focus-input100" data-placeholder="&#xf191;"></span>
							</div>
						</div>
					</div>
					<!-- <div class="contact100-form-checkbox">
						<input class="input-checkbox100" id="ckb1" type="checkbox" name="remember-me">
						<label class="label-checkbox100" for="ckb1">
							Remember me
						</label>
					</div> -->
					<div class="container-login100-form-btn">
						<button type="submit" id="signup-btn" class="login100-form-btn">
							Sign Up
						</button>
					</div>
					<div class="text-center p-t-60">
						<a class="txt1" href="login.html">
							Sudah pernah mendaftar? Silahkan Log In.
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- start js include path -->
	<script src="assets/plugins/jquery/jquery.min.js"></script>
	<!-- bootstrap -->
	<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="assets/js/pages/extra_pages/login.js"></script>
	<!-- end js include path -->
	<script>
		const emailRegex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/

		document.querySelector('#signup-btn').addEventListener('click', async e => {
			e.preventDefault()
			
			const phone = document.querySelector('#phone-input').value
			const email =  document.querySelector('#email-input').value
			const password = document.querySelector('#password-input').value
			const passwordConfirm = document.querySelector('#password-confirm-input').value

			if (phone === "") {
				alert('Harap isi nomor telepon.')
			} else if (email === "") {
				alert('Harap isi email.')
			} else if (!email.match(emailRegex)) {
				alert('Harap input email yg valid.')
			} else if (password === "") {
				alert('Harap isi password.')
			} else if (password !== passwordConfirm) {
				alert('Password tidak match.')
			} else {
				const apiUrlResponse = await fetch(`/api_url.txt`)
				const apiUrl = await apiUrlResponse.text()

				let initialUser = {
					user: {
						email: email,
						password: password,
						serviceType: null
					},
					partner: { 
						phone: phone
					}
				}

				try {
					const response = await fetch(`${apiUrl}/register`, {
						method: 'post',
						headers: {
							'content-type': 'application/json'
						},
						body: JSON.stringify(initialUser)
					})

					if (response.status === 500) throw await response.text()

					alert('Sign-up sukses!')
					window.location = '/login.html'	
				} catch (e) {
					console.log(e)
					alert(e)
				}
			}
		})
		
	</script>
</body>

</html>