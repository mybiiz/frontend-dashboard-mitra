<!DOCTYPE html>
<html lang="id">
<!-- BEGIN HEAD -->

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1" name="viewport" />
	<meta name="description" content="Responsive Admin Template" />
	<meta name="author" content="SmartUniversity" />
	<title>Mitra Mybiiz</title>
	<!-- icons -->
	<link href="assets/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
	<link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<!--bootstrap -->
	<link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<!-- Material Design Lite CSS -->
	<link rel="stylesheet" href="assets/plugins/material/material.min.css">
	<link rel="stylesheet" href="assets/css/material_style.css">
	<!-- animation -->
	<link href="assets/css/pages/animate_page.css" rel="stylesheet">
	<!-- Template Styles -->
	<link href="assets/css/style.css" rel="stylesheet" type="text/css" />
	<link href="assets/css/plugins.min.css" rel="stylesheet" type="text/css" />
	<link href="assets/css/responsive.css" rel="stylesheet" type="text/css" />
	<link href="assets/css/theme-color.css" rel="stylesheet" type="text/css" />
	<!-- dropzone -->
	<link href="assets/plugins/dropzone/dropzone.css" rel="stylesheet" media="screen">
	<!-- favicon -->
  <link rel="shortcut icon" href="assets/img/favicon.ico" />
  <!-- Compressor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/compressorjs/1.0.7/compressor.min.js" integrity="sha512-ZNlHFR9FBdeIlhwh040g5JmmYj7DQOwkqb9Y+DBJ1MaTzRMxKZkfHWkQU/dazDn9XRriajfh7ZGFksBKeUCsCg==" crossorigin="anonymous"></script>
</head>
<!-- END HEAD -->

<body
class="page-header-fixed sidemenu-closed-hidelogo page-content-white page-md header-white custom-sidebar-color logo-custom">
	<div class="page-wrapper">
		<!-- start header -->
		<div class="page-header navbar navbar-fixed-top">
			<div class="page-header-inner ">
				<!-- logo start -->
				<div class="page-logo">
					<a href="index.html">
						<img alt="" src="assets/img/logo.png">
				</div>
				<!-- logo end -->
				<!-- start mobile menu -->
				<a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span></span>
				</a>
				<!-- end mobile menu -->
				<!-- start header menu -->
				<div class="top-menu">
					<ul class="nav navbar-nav pull-right">
						<!-- start notification dropdown -->
						<li class="dropdown dropdown-extended dropdown-notification" id="header_notification_bar">
							<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown"
								data-close-others="true">
								<i class="fa fa-bell-o"></i>
								<!-- <span class="badge headerBadgeColor1"> {{Jumlah Notif}} </span> -->
							</a>
							<ul class="dropdown-menu animated swing">
								<li class="external">
									<h3><span class="bold">Notifications</span></h3>
								</li>
								<li>
									<ul class="dropdown-menu-list small-slimscroll-style" data-handle-color="#637283">
										<li>
											<a href="javascript:;">
												<span class="time">{{time notif}}</span>
												<span class="details">
													<span class="notification-icon circle deepPink-bgcolor"><i
															class="fa fa-check"></i></span> {{notif tittle}} </span>
											</a>
										</li>
									</ul>
									<div class="dropdown-menu-footer">
										<a href="javascript:void(0)"> All notifications </a>
									</div>
								</li>
							</ul>
						</li>
						<!-- end notification dropdown -->
						<!-- start manage user dropdown -->
						<li class="dropdown dropdown-user">
							<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown"
								data-close-others="true">
								<img alt="" class="img-circle " src="../../" /> <!--foto user-->
								<span class="username username-hide-on-mobile" id="username"></span>
								<i class="fa fa-angle-down"></i>
							</a>
							<ul class="dropdown-menu dropdown-menu-default animated jello">
								<li>
									<a href="user_profile.html">
										<i class="icon-user"></i> Profile </a>
								</li>
								<li>
									<a href="#">
										<i class="icon-settings"></i> Settings
									</a>
								</li>
								<li class="divider"> </li>
								<li>
									<a id="logout-btn">
										<i class="icon-logout"></i> Log Out </a>
								</li>
							</ul>
						</li>
						<!-- end manage user dropdown -->
					</ul>
				</div>
			</div>
		</div>
		<!-- end header -->
		<!-- start page container -->
		<div class="page-container row">
			<!-- start sidebar menu -->
			<div class="sidebar-container col-2 px-0">
				<div class="sidemenu-container navbar-collapse collapse fixed-menu">
					<div id="remove-scroll">
						<ul class="sidemenu page-header-fixed p-t-20" data-keep-expanded="false" data-auto-scroll="true"
							data-slide-speed="200">
							<li class="sidebar-toggler-wrapper hide">
								<div class="sidebar-toggler">
									<span></span>
								</div>
							</li>
							<li class="sidebar-user-panel">
								<div class="user-panel">
									<!-- <div class="row">
										<div class="sidebar-userpic">
											<img src="assets/img/dp.jpg" class="img-responsive" alt="">
										</div>
									</div> -->
									<div class="profile-usertitle">
										<div class="sidebar-userpic-name" id="user-name"></div>
									</div>
									<div class="sidebar-userpic-btn">
										<a class="tooltips" href="user_profile.html" data-placement="top"
											data-original-title="Profile">
											<i class="material-icons">person_outline</i>
										</a>
										<a class="tooltips" href="chat.html" data-placement="top"
											data-original-title="Chat">
											<i class="material-icons">chat</i>
										</a>
										<a class="tooltips" id="logout-icon" data-placement="top"
											data-original-title="Logout">
											<i class="material-icons">input</i>
										</a>
									</div>
								</div>
							</li>
							<li class="nav-item start active">
								<a href="index.html" class="nav-link">
									<i class="material-icons">dashboard</i>
									<span class="title">Dashboard</span>
									<span class="selected"></span>
								</a>
							</li>
							<!-- <li class="nav-item">
								<a href="#" class="nav-link nav-toggle">
									<i class="material-icons">business_center</i>
									<span class="title">Booking</span>
									<span class="arrow"></span>
								</a>
								<ul class="sub-menu">
									<li class="nav-item">
										<a href="add_book_room.html" class="nav-link ">
											<span class="title">Booking Baru</span>
										</a>
									</li>
									<li class="nav-item">
										<a href="book_room.html" class="nav-link ">
											<span class="title">Lihat Booking</span>
										</a>
									</li>
								</ul>
							</li> -->
							<li class="nav-item">
								<a href="#" class="nav-link nav-toggle">
									<i class="material-icons">vpn_key</i>
									<span class="title">Rooms</span>
									<span class="arrow"></span>
								</a>
								<ul class="sub-menu">
									<li class="nav-item">
										<a href="add_room.html?room_id=new" class="nav-link ">
											<span class="title">Tambah Kamar</span>
										</a>
									</li>
									<li class="nav-item">
										<a href="all_rooms.html" class="nav-link ">
											<span class="title">Lihat Kamar</span>
										</a>
									</li>
									<!-- <li class="nav-item">
										<a href="edit_room.html" class="nav-link ">
											<span class="title">Edit Kamar</span>
										</a>
									</li> -->
								</ul>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!-- end sidebar menu -->
			<!-- start page content -->
			<div class="page-content-wrapper col-10">
				<div class="page-content">
					<div class="page-bar container">
						<div class="page-title-breadcrumb">
							<div class=" pull-left">
								<div class="page-title">Tambah Kamar</div>
							</div>
							<ol class="breadcrumb page-breadcrumb pull-right">
								<li><i class="fa fa-home"></i>&nbsp;<a class="parent-item"
										href="index.html">Home</a>&nbsp;<i class="fa fa-angle-right"></i>
								</li>
								<li><a class="parent-item" href="">Rooms</a>&nbsp;<i class="fa fa-angle-right"></i>
								</li>
								<li class="active">Tambah Kamar</li>
							</ol>
						</div>
					</div>
					<div class="container">
						<div class="row">
							<div class="col-sm-12">
								<div class="card-box">
									<div class="card-head">
										<header>Detail Kamar</header>
									</div>
									<div class="card-body row">
										<div class="col-lg-6 p-t-20">
											<div
												class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label txt-full-width">
												<input class="mdl-textfield__input" type="text" id="roomNumber">
												<label class="mdl-textfield__label">Nomor Kamar</label>
											</div>
										</div>
										<div class="col-lg-6 p-t-20">
											<div
												class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label txt-full-width">
                        <label for="roomType" class="mdl-textfield__label">Tipe Kamar (Selected: <span id="selected-room-type"></span>)</label>
												<select class="mdl-textfield__input" id="roomType" >
												</select>
											</div>
										</div>
										<div class="col-lg-6 p-t-20">
											<div
												class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height txt-full-width">
												<input class="mdl-textfield__input" type="text" id="hasAC" value=""
													readonly tabIndex="-1">
												<label for="hasAC" class="pull-right margin-0">
													<i class="mdl-icon-toggle__label material-icons">keyboard_arrow_down</i>
												</label>
												<label for="hasAC" class="mdl-textfield__label">AC/Non AC (Selected: <span id="selected-ac-non-ac"></span>)</label>
												<ul data-mdl-for="hasAC"
													class="mdl-menu mdl-menu--bottom-left mdl-js-menu">
													<li class="mdl-menu__item" data-val=true>AC</li>
													<li class="mdl-menu__item" data-val=false>Non AC</li>
												</ul>
											</div>
										</div>
										<div class="col-lg-6 p-t-20">
											<div
												class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label txt-full-width">
												<label for="foodAccomodationTypes" class="mdl-textfield__label">Makan (Selected: <span id="selected-food-type"></span>)</label>
												<select class="mdl-textfield__input" id="foodAccomodationTypes">
												</select>
											</div>
										</div>
										<div class="col-lg-6 p-t-20">
											<div
												class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label txt-full-width">
												<label for="cancellationFee" class="mdl-textfield__label">Biaya Pembatalan (Selected: <span id="selected-cancellation-fee"></span>)</label>
												<select class="mdl-textfield__input" id="cancellationFee">
												</select>
											</div>
										</div>
										<div class="col-lg-6 p-t-20">
											<div
												class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height txt-full-width">
												<input class="mdl-textfield__input" type="text" id="bedCapacity" value="" readonly
													tabIndex="-1">
												<label for="bedCapacity" class="pull-right margin-0">
													<i class="mdl-icon-toggle__label material-icons">keyboard_arrow_down</i>
												</label>
												<label for="bedCapacity" class="mdl-textfield__label">Bed Capacity (Selected: <span id="selected-bed-capacity"></span>)</label>
												<ul data-mdl-for="bedCapacity" class="mdl-menu mdl-menu--bottom-left mdl-js-menu">
													<li class="mdl-menu__item" data-val="1">1</li>
													<li class="mdl-menu__item" data-val="2">2</li>
													<li class="mdl-menu__item" data-val="3">3</li>
													<li class="mdl-menu__item" data-val="4">4</li>
												</ul>
											</div>
										</div>
										<div class="col-lg-6 p-t-20">
											<div
												class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label txt-full-width">
												<label for="guestType" class="mdl-textfield__label">Tipe Tamu (Selected: <span id="selected-guest-type"></span>)</label>
												<select class="mdl-textfield__input" id="guestType">
												</select>
											</div>
										</div>
										<div class="col-lg-6 p-t-20">
											<div
												class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label txt-full-width">
												<input class="mdl-textfield__input" type="text"
													pattern="-?[0-9]*(\.[0-9]+)?" id="price">
												<label class="mdl-textfield__label" for="text7">Harga Permalam</label>
												<span class="mdl-textfield__error">Number required!</span>
											</div>
										</div>
										<div class="col-lg-12 p-t-20">
											<label class="control-label col-md-3">Upload Foto Kamar</label>
                      
                      <div id='drop-room-img' class="d-flex justify-content-center align-items-center p-3 border border-secondary">
                        Seret gambar ke sini atau klik di sini untuk upload file
                      </div>

                      <div id='room-img-preview'>
                        
                      </div>

                      <input type="file" id='room-img-input' style="display:none" />
                      <!-- <form id="id_dropzone" class="dropzone">
												<div class="dz-message">
													<div class="dropIcon">
														<i class="material-icons">cloud_upload</i>
													</div>
													<h3>Seret gambar ke sini atau klik untuk menguanggah.</h3>
												</div>
											</form> -->
										</div>
										<div class="col-lg-12 p-t-20">
											<div class="mdl-textfield mdl-js-textfield txt-full-width">
												<textarea class="mdl-textfield__input" rows="4" id="description"></textarea>
												<label class="mdl-textfield__label" for="text7">Deskripsi</label>
											</div>
										</div>
										<div class="col-lg-12 p-t-20 text-center">
											<button type="button" id="submitBtn"
												class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect m-b-10 m-r-20 btn-pink">Submit</button>
											<button type="button" id="cancel-btn"
												class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect m-b-10 btn-default">Cancel</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- end page content -->
		</div>
		<!-- end page container -->
		<!-- start footer -->
		<div class="page-footer">
			<div class="page-footer-inner"> 2020 &copy;
				<a href="https://mybiiz.com" target="_top" class="makerCss">MyBiiz</a>
			</div>
			<div class="scroll-to-top">
				<i class="icon-arrow-up"></i>
			</div>
		</div>
		<!-- end footer -->
	</div>
	<!-- start js include path -->
	<script src="assets/plugins/jquery/jquery.min.js"></script>
	<script src="assets/plugins/popper/popper.min.js"></script>
	<script src="assets/plugins/jquery-blockui/jquery.blockui.min.js"></script>
	<script src="assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
	<!-- bootstrap -->
	<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
	<!-- Common js-->
	<script src="assets/js/app.js"></script>
	<script src="assets/js/layout.js"></script>
	<script src="assets/js/theme-color.js"></script>
	<!-- Material -->
	<script src="assets/plugins/material/material.min.js"></script>
	<script src="assets/js/pages/material_select/getmdl-select.js"></script>
	<!-- dropzone -->
	<script src="assets/plugins/dropzone/dropzone.js"></script>
	<script src="assets/plugins/dropzone/dropzone-call.js"></script>
	<!-- animation -->
	<script src="assets/js/pages/ui/animations.js"></script>
	<!-- end js include path -->
	<script src="https://cdn.jsdelivr.net/npm/jwt-decode@2.2.0/build/jwt-decode.min.js"></script>
	<script>

    

    /* Variables */
    let data;
    
    let megabytesLimit = 2 * 1024 * 1024;
    let id = undefined;
		let roomTypeId = 0;
		let hasAC = false;
		let foodTypeId = 0;
		let cancellationFeeId;
		let bedCapacity = '';
    let guestTypeId = 0;
    let createdAt = undefined;
    let updatedAt = undefined;
    
    let roomImageViews = []

    let roomTypes = []
    let foodTypes = []
    let cancellationFees = []
    let guestTypes = []

    let initialRoomImage = {
      id: undefined,
      createdAt: null,
      updatedAt: null,
      createdAt: null,
      roomId: null,
      dataPrefix: ''
    }

    const execute = async () => {
      const roomId = new URLSearchParams (window.location.search).get('room_id')
      console.log('Room ID:', roomId)

      const apiKey = localStorage.getItem('apiKey')
      
      if (!apiKey) {
        window.location = '/'
      }

      document.querySelector('#logout-btn').addEventListener('click', e => {
        localStorage.removeItem('apiKey')
        window.location = '/'
      })

      document.querySelector('#logout-icon').addEventListener('click', e => {
        localStorage.removeItem('apiKey')
        window.location = '/'
      })

      /* Logout and Cancel Button */
      document.querySelector('#logout-btn').addEventListener('click', e => {
        localStorage.removeItem("apiKey")
        window.location = '/'
      });
      
      document.querySelector('#logout-icon').addEventListener('click', e => {
        localStorage.removeItem("apiKey")
        window.location = '/'
      });
      
      document.querySelector('#cancel-btn').addEventListener('click', () => window.history.back());
  
      

      const fetchBusinessData = async () => {
        try {
          const apiUrlResponse = await fetch(`/api_url.txt`)
          const apiUrl = await apiUrlResponse.text()
          const apiKey = localStorage.getItem('apiKey')
          const userId = jwt_decode(apiKey).id
          const response = await fetch(`${apiUrl}/users/${userId}/view`, {
            method: 'get',
            headers: { authorization: localStorage.getItem('apiKey') },
          });
          if (response.status !== 200) throw await response.text()
          res = await response.json();
          data = res.partners[0];
        } catch (e) {
          console.error(e)
        }
      }

      /* Get Types  */
      const fetchRoomTypes= async () => {
        try {
          const apiUrlResponse = await fetch(`/api_url.txt`);
          const apiUrl = await apiUrlResponse.text();
          const apiKey = localStorage.getItem('apiKey')
          const id = jwt_decode(apiKey).id
          const roomTypesResponse = await fetch(`${apiUrl}/roomtypes`, {
            headers: { 
              authorization: apiKey,
            }
          }) 
          if (roomTypesResponse.status !== 200) throw await response.text()
          roomTypes = await roomTypesResponse.json()

          const roomTypesMapped = roomTypes.map(roomType => `
            <option value="${roomType.id}">${roomType.name}</option>					
          `).join('')

          document.querySelector(`#roomType`).innerHTML = `
            <option value="0"></option>
            ${roomTypesMapped}
          `
        } catch (e) {
          console.error(e)
        }
      }

      const fetchFoodAccomodation = async () => {
        try {
          const apiUrlResponse = await fetch(`/api_url.txt`);
          const apiUrl = await apiUrlResponse.text();
          const apiKey = localStorage.getItem('apiKey')
          const id = jwt_decode(apiKey).id
          const foodTypesResponse = await fetch(`${apiUrl}/foodaccomodations`, {
            headers: { 
              authorization: apiKey,
            }
          }) 
          if (foodTypesResponse.status !== 200) throw await response.text()
          foodTypes = await foodTypesResponse.json()

          const foodTypesMapped = foodTypes.map(foodType => `
            <option value="${foodType.id}">${foodType.name}</option>					
          `).join('')

          document.querySelector(`#foodAccomodationTypes`).innerHTML = `
            <option value="0"></option>
            ${foodTypesMapped}
          `
        } catch (e) {
          console.error(e)
        }
      }

      const fetchCancelationFees = async () => {
        try {
          const apiUrlResponse = await fetch(`/api_url.txt`);
          const apiUrl = await apiUrlResponse.text();
          const apiKey = localStorage.getItem('apiKey')
          const id = jwt_decode(apiKey).id
          const cancellationFeeResponse = await fetch(`${apiUrl}/cancellationfees`, {
            headers: { 
              authorization: apiKey,
            }
          }) 
          if (cancellationFeeResponse.status !== 200) throw await response.text()
          cancellationFees = await cancellationFeeResponse.json()

          const cancellationFeeMapped = cancellationFees.map(fee => `
            <option value="${fee.id}">${fee.name}</option>					
          `).join('')

          document.querySelector(`#cancellationFee`).innerHTML = `
            <option value="0"></option>
            ${cancellationFeeMapped}
          `
        } catch (e) {
          console.error(e)
        }
      }

      const fetchGuestType = async () => {
        try {
          const apiUrlResponse = await fetch(`/api_url.txt`);
          const apiUrl = await apiUrlResponse.text();
          const apiKey = localStorage.getItem('apiKey')
          const id = jwt_decode(apiKey).id
          const guestTypeResponse = await fetch(`${apiUrl}/guesttypes`, {
            headers: { 
              authorization: apiKey,
            }
          }) 
          if (guestTypeResponse.status !== 200) throw await response.text()
          guestTypes = await guestTypeResponse.json()

          const guestTypeMapped = guestTypes.map(type => `
            <option value="${type.id}">${type.name}</option>					
          `).join('')

          document.querySelector(`#guestType`).innerHTML = `
            <option value="0"></option>
            ${guestTypeMapped}
          `
        } catch (e) {
          console.error(e)
        }
      }

      const fetchRoom = async () => {
        try {
          const apiUrlResponse = await fetch(`/api_url.txt`)
          const apiUrl = await apiUrlResponse.text()
          const apiKey = localStorage.getItem('apiKey')
          const userId = jwt_decode(apiKey).id
          const response = await fetch(`${apiUrl}/rooms/${roomId}/view`, {
            method: 'get',
            headers: { authorization: localStorage.getItem('apiKey') },
          });
          if (response.status !== 200) throw await response.text()
          const res = await response.json();
          
          console.log("Room data:", res)
          console.log("Room types:", roomTypes, res.room.roomTypeId)
          console.log("Room image views:", res.roomImageViews)

          id = res.room.id;

          document.querySelector('#roomNumber').value = res.room.number

          roomTypeId = res.room.roomTypeId
          document.querySelector('#selected-room-type').innerHTML = roomTypes.find(roomType => roomType.id === roomTypeId)?.name
          
          hasAc = res.room.hasAc
          
          if (hasAc) {
            document.querySelector('#selected-ac-non-ac').innerHTML = 'AC'
          } else {
            document.querySelector('#selected-ac-non-ac').innerHTML = 'Non AC'
          }
          
          foodTypeId = res.room.foodAccomodationId
          document.querySelector('#selected-food-type').innerHTML = foodTypes.find(foodType => foodType.id === foodTypeId)?.name
          
          guestTypeId = res.room.guestTypeId
          document.querySelector('#selected-guest-type').innerHTML = guestTypes.find(guestType => guestType.id === guestTypeId)?.name

          cancellationFeeId = res.room.cancellationFeeId
          document.querySelector('#selected-cancellation-fee').innerHTML = cancellationFees.find(cancellationFee => cancellationFee.id === cancellationFeeId)?.name
          
          bedCapacity = res.room.bedCapacity
          document.querySelector('#selected-bed-capacity').innerHTML = bedCapacity

          document.querySelector('#price').value = res.room.price
          document.querySelector('#description').value = res.room.description

          createdAt = res.room.createdAt
          updatedAt = res.room.updatedAt
          
          roomImageViews = res.roomImageViews

          renderRoomImages()
          // data = res.partners[0];
        } catch (e) {
          console.error(e)
        }
      }

      const fetchUser = async () => {
        try {
          const apiUrlResponse = await fetch(`/api_url.txt`)
          const apiUrl = await apiUrlResponse.text()
          const apiKey = localStorage.getItem('apiKey')
          const id = jwt_decode(apiKey).id
          const response = await fetch(`${apiUrl}/users/${id}/view`, {
            method: 'get',
            headers: { authorization: localStorage.getItem('apiKey') },
          });
          if (response.status !== 200) throw await response.text()
          const user = await response.json();
          const partner = user.partners[0];

          if (partner) {
            document.querySelector('#user-name').innerText = `${partner.firstName} ${partner.lastName}`;
            document.querySelector('#username').innerText = user.email;
          }
          
        } catch (e) {
          console.error(e)
        }
      }

      await Promise.all([
        fetchRoomTypes(),
        fetchFoodAccomodation(),
        fetchCancelationFees(),
        fetchGuestType(),
        fetchBusinessData(),
        fetchUser()
      ])

      if (roomId && !isNaN(roomId)) {
        fetchRoom();  
      }

      /* Form On Change Functions */
      document.querySelector('#roomType').addEventListener('change', e => {
        roomTypeId = parseInt(e.target.value)

        console.log("Selected room id:", e.target.value, typeof e.target.value)

        const foundRoomType = roomTypes.find(roomType => 
            roomType.id.toString() === e.target.value
          )

        console.log('Found room tuype', foundRoomType)

        document.querySelector('#selected-room-type').innerHTML = foundRoomType.name
          
      });
      document.querySelector('#hasAC').addEventListener('change', e => {
        if (e.target.value == 'AC') {
          hasAC = true;
          document.querySelector('#selected-ac-non-ac').innerHTML = 'AC'
        } else {
          hasAC = false;
          document.querySelector('#selected-ac-non-ac').innerHTML = 'Non AC'
        }
      });
      document.querySelector('#foodAccomodationTypes').addEventListener('change', e => {
        foodTypeId = parseInt(e.target.value)
        document.querySelector('#selected-food-type').innerHTML = foodTypes.find(foodType => foodType.id.toString() === e.target.value.toString())?.name
      });
      document.querySelector('#cancellationFee').addEventListener('change', e => {
        cancellationFeeId = parseInt(e.target.value)
        document.querySelector('#selected-cancellation-fee').innerHTML = cancellationFees.find(cancellationFee => cancellationFee.id.toString() === e.target.value.toString())?.name
      });
      document.querySelector('#bedCapacity').addEventListener('change', e => {
        bedCapacity = parseInt(e.target.value);
        document.querySelector('#selected-bed-capacity').innerHTML = e.target.value.toString( )
      });
      document.querySelector('#guestType').addEventListener('change', e => {
        guestTypeId = parseInt(e.target.value)
        document.querySelector('#selected-guest-type').innerHTML = guestTypes.find(guestType => guestType.id.toString() === e.target.value.toString())?.name
      });

      document.querySelector('#drop-room-img').addEventListener('click', e => {
        document.querySelector('#room-img-input').click()
      });
       
      const renderRoomImages = () => {
        document.querySelector('#room-img-preview').innerHTML = roomImageViews.map(roomImageView => `
          <div class="d-flex justify-content-center my-2 border border-secondary">
            <img src="${roomImageView.imageBase64}" />  
          </div>
        `).join('')
      }
    
      const processFile = (file) => {
        console.log(file)

        const compressor = new Compressor(file, {
          quality: 0.5,
          maxWidth: 300,
          success: (res) => {
            const reader = new FileReader()
            reader.readAsDataURL(res)
            reader.onload = () => {
              const dataPrefix = reader.result.split(';base64,')[0]

              roomImageViews.push({ 
                roomImage: { ...initialRoomImage, dataPrefix: dataPrefix },
                imageBase64: reader.result
              })

              renderRoomImages()
            }

            reader.onerror = e => {
              console.error(e)
            }
          },
          error: (err) => {
            console.error(err)
          }
        })
      }

      document.querySelector('#room-img-input').addEventListener('input', e => {
        e.preventDefault()
        processFile(e.target.files[0])
      });

      document.querySelector('#drop-room-img').addEventListener('drop', e => {
        e.preventDefault()
        document.querySelector('#drop-room-img').className = 'd-flex justify-content-center align-items-center p-3 border border-secondary'
        document.querySelector('#room-img-input').click()
        processFile(e.dataTransfer.items[0].getAsFile())
      });

      document.querySelector('#drop-room-img').addEventListener('dragover', e => {
        e.preventDefault()
        document.querySelector('#drop-room-img').className = 'd-flex justify-content-center align-items-center p-3 border border-secondary bg-secondary'
      });

      document.querySelector('#drop-room-img').addEventListener('dragleave', e => {
        e.preventDefault()
        document.querySelector('#drop-room-img').className = 'd-flex justify-content-center align-items-center p-3 border border-secondary'
      });
      
      /* Post Form Add Room */
      document.querySelector('#submitBtn').addEventListener('click', async (e) => {
        e.preventDefault();

        const roomNumber = document.querySelector('#roomNumber').value;
        const price = document.querySelector('#price').value;
        const description = document.querySelector('#description').value;
        
        // Validation
        if (roomNumber === '')
          alert('Harap isi nomor kamar!')
        else if (roomTypeId === 0)
          alert('Harap pilih tipe kamar!')
        else if (hasAC === null)
          alert('Harap pilih AC/Non AC!')
        else if (foodTypeId === 0)
          alert('Harap pilih fasilitas makanan!')
        else if (cancellationFeeId === 0)
          alert('Harap pilih biaya pembatalan!')
        else if (bedCapacity === '')
          alert('Harap pilih kapasitas tempat tidur!')
        else if (guestTypeId === 0)
          alert('Harap isi tipe tamu!')
        else if (price === '')
          alert('Harap isi harga!')
        else {
          const roomData = {
            id: id,
            bedCapacity: bedCapacity,
            business: null,//
            businessId: data.business.id,
            cancellationFee: null,//
            cancellationFeeId: cancellationFeeId,
            description: description,
            foodAccomodation: null,//
            foodAccomodationId: foodTypeId,
            guestType: null,//
            guestTypeId: guestTypeId,
            hasAc: hasAC,
            name: data.business.name,
            number: roomNumber,
            price: parseInt(price),
            roomType: null, //
            roomTypeId: roomTypeId,
            createdAt: createdAt,
            updatedAt: updatedAt
          }

          console.log('room image views', roomImageViews)

          const roomPostBody = {
            room: roomData,
            roomImageViews: roomImageViews,
            roomImageDeleteIds: []
          }

          console.log('ROOMDATA', roomPostBody)

          try {
            const apiUrlResponse = await fetch(`/api_url.txt`);
            const apiUrl = await apiUrlResponse.text();
            const response = await fetch(`${apiUrl}/rooms/save`, {
              method: 'post',
              headers: { authorization: localStorage.getItem('apiKey') },
              body: JSON.stringify(roomPostBody)
            })
            if (response.status !== 200) throw await response.text()
            //window.location = '/'
          } catch (e) {
            console.error(e)
          }

          console.log('ROOMDATA', roomData)
          alert('Kamar berhasil dibuat!');
          window.location.href = 'all_rooms.html';
        }
      });

      
      
      /* Image Upload */
      // const checkAndAddFile = (file) => {
      // 	if (file.size > megabytesLimit) {
      // 		alert(`Ukuran file melebihi batas! Max: 2MB, file yg diupload: ${Math.round(file.size/1024/1024)}MB`)
      // 	} else {
      // 		const reader = new FileReader()
      // 		reader.readAsDataURL(file)
      // 		reader.onload = () => {
      // 			const imgResult = reader.result
      // 			imgResultBase64 = imgResult;
      // 			document.querySelector('#file-image').src = imgResult;
      // 			document.querySelector('#file-image').classList.remove('hidden');
      // 			document.querySelector('#start').classList.add('hidden');
      // 		}
      // 		reader.onerror = () => {
      // 			document.querySelector('#file-image').classList.add('hidden');
      // 			document.querySelector('#start').classList.remove('hidden');
      // 		}
      // 	}
      // }

      // To be used later
      // document.querySelector('#file-upload').addEventListener('change', e => {
      // 	e.preventDefault()
      // 	checkAndAddFile(e.target.files[0])
      // });

      // document.querySelector('#clear-img-btn').addEventListener('click', e => {
      // 	e.preventDefault()
      // 	imgResultBase64 = ''
      // 	document.querySelector('#file-image').src = '';
      // 	document.querySelector('#file-image').classList.add('hidden');
      // 	document.querySelector('#start').classList.remove('hidden');
      // })

      // const dropHandler = e => {
      // 	e.preventDefault();
      // 	checkAndAddFile(e.dataTransfer.files[0])
      // }

      // const dragOverHandler = e => {
      // 	e.preventDefault();
      // }
      }

      execute()
		
	</script>
</body>

</html>